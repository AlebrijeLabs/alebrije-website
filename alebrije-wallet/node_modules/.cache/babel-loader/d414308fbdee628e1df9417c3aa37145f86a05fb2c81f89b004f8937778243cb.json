{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.TrezorConnectDynamic = void 0;\nconst constants_1 = require(\"../constants\");\nconst proxy_event_emitter_1 = require(\"../utils/proxy-event-emitter\");\nclass TrezorConnectDynamic {\n  eventEmitter;\n  currentTarget;\n  implementations;\n  getInitTarget;\n  handleBeforeCall;\n  handleErrorFallback;\n  lastSettings;\n  constructor(_ref) {\n    let {\n      implementations,\n      getInitTarget,\n      handleBeforeCall,\n      handleErrorFallback\n    } = _ref;\n    this.implementations = implementations;\n    this.currentTarget = this.implementations[0].type;\n    this.getInitTarget = getInitTarget;\n    this.handleBeforeCall = handleBeforeCall;\n    this.handleErrorFallback = handleErrorFallback;\n    this.eventEmitter = new proxy_event_emitter_1.ProxyEventEmitter(this.implementations.map(impl => impl.impl.eventEmitter));\n  }\n  getTarget() {\n    return this.implementations.find(impl => impl.type === this.currentTarget).impl;\n  }\n  getTargetType() {\n    return this.currentTarget;\n  }\n  async switchTarget(target) {\n    if (this.currentTarget === target) {\n      return;\n    }\n    if (!this.lastSettings) {\n      throw constants_1.ERRORS.TypedError('Init_NotInitialized');\n    }\n    const oldTargetType = this.getTargetType();\n    const oldTarget = this.getTarget();\n    try {\n      this.currentTarget = target;\n      await this.getTarget().init(this.lastSettings);\n      await oldTarget.dispose();\n    } catch {\n      this.currentTarget = oldTargetType;\n    }\n  }\n  manifest(manifest) {\n    this.lastSettings = {\n      ...this.lastSettings,\n      manifest\n    };\n    this.getTarget().manifest(manifest);\n  }\n  async init(settings) {\n    if (!settings?.manifest) {\n      throw constants_1.ERRORS.TypedError('Init_ManifestMissing');\n    }\n    this.lastSettings = settings;\n    this.currentTarget = this.getInitTarget(settings);\n    try {\n      return await this.getTarget().init(this.lastSettings);\n    } catch (error) {\n      if (await this.handleErrorFallback(error.code)) {\n        return await this.getTarget().init(settings);\n      }\n      throw error;\n    }\n  }\n  setTransports(_ref2) {\n    let {\n      transports\n    } = _ref2;\n    this.lastSettings = {\n      ...this.lastSettings,\n      transports\n    };\n    this.getTarget().setTransports({\n      transports\n    });\n  }\n  async call(params) {\n    await this.handleBeforeCall();\n    const response = await this.getTarget().call(params);\n    if (!response.success) {\n      if (await this.handleErrorFallback(response.payload.code)) {\n        return await this.getTarget().call(params);\n      }\n    }\n    return response;\n  }\n  requestLogin(params) {\n    return this.getTarget().requestLogin(params);\n  }\n  uiResponse(params) {\n    return this.getTarget().uiResponse(params);\n  }\n  cancel(error) {\n    return this.getTarget().cancel(error);\n  }\n  dispose() {\n    this.eventEmitter.removeAllListeners();\n    return this.getTarget().dispose();\n  }\n}\nexports.TrezorConnectDynamic = TrezorConnectDynamic;","map":{"version":3,"names":["Object","defineProperty","exports","value","TrezorConnectDynamic","constants_1","require","proxy_event_emitter_1","eventEmitter","currentTarget","implementations","getInitTarget","handleBeforeCall","handleErrorFallback","lastSettings","constructor","_ref","type","ProxyEventEmitter","map","impl","getTarget","find","getTargetType","switchTarget","target","ERRORS","TypedError","oldTargetType","oldTarget","init","dispose","manifest","settings","error","code","setTransports","_ref2","transports","call","params","response","success","payload","requestLogin","uiResponse","cancel","removeAllListeners"],"sources":["/Users/rastavo/alebrije-project/alebrije-wallet/node_modules/@trezor/connect/lib/impl/dynamic.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.TrezorConnectDynamic = void 0;\nconst constants_1 = require(\"../constants\");\nconst proxy_event_emitter_1 = require(\"../utils/proxy-event-emitter\");\nclass TrezorConnectDynamic {\n    eventEmitter;\n    currentTarget;\n    implementations;\n    getInitTarget;\n    handleBeforeCall;\n    handleErrorFallback;\n    lastSettings;\n    constructor({ implementations, getInitTarget, handleBeforeCall, handleErrorFallback, }) {\n        this.implementations = implementations;\n        this.currentTarget = this.implementations[0].type;\n        this.getInitTarget = getInitTarget;\n        this.handleBeforeCall = handleBeforeCall;\n        this.handleErrorFallback = handleErrorFallback;\n        this.eventEmitter = new proxy_event_emitter_1.ProxyEventEmitter(this.implementations.map(impl => impl.impl.eventEmitter));\n    }\n    getTarget() {\n        return this.implementations.find(impl => impl.type === this.currentTarget).impl;\n    }\n    getTargetType() {\n        return this.currentTarget;\n    }\n    async switchTarget(target) {\n        if (this.currentTarget === target) {\n            return;\n        }\n        if (!this.lastSettings) {\n            throw constants_1.ERRORS.TypedError('Init_NotInitialized');\n        }\n        const oldTargetType = this.getTargetType();\n        const oldTarget = this.getTarget();\n        try {\n            this.currentTarget = target;\n            await this.getTarget().init(this.lastSettings);\n            await oldTarget.dispose();\n        }\n        catch {\n            this.currentTarget = oldTargetType;\n        }\n    }\n    manifest(manifest) {\n        this.lastSettings = { ...this.lastSettings, manifest };\n        this.getTarget().manifest(manifest);\n    }\n    async init(settings) {\n        if (!settings?.manifest) {\n            throw constants_1.ERRORS.TypedError('Init_ManifestMissing');\n        }\n        this.lastSettings = settings;\n        this.currentTarget = this.getInitTarget(settings);\n        try {\n            return await this.getTarget().init(this.lastSettings);\n        }\n        catch (error) {\n            if (await this.handleErrorFallback(error.code)) {\n                return await this.getTarget().init(settings);\n            }\n            throw error;\n        }\n    }\n    setTransports({ transports }) {\n        this.lastSettings = { ...this.lastSettings, transports };\n        this.getTarget().setTransports({ transports });\n    }\n    async call(params) {\n        await this.handleBeforeCall();\n        const response = await this.getTarget().call(params);\n        if (!response.success) {\n            if (await this.handleErrorFallback(response.payload.code)) {\n                return await this.getTarget().call(params);\n            }\n        }\n        return response;\n    }\n    requestLogin(params) {\n        return this.getTarget().requestLogin(params);\n    }\n    uiResponse(params) {\n        return this.getTarget().uiResponse(params);\n    }\n    cancel(error) {\n        return this.getTarget().cancel(error);\n    }\n    dispose() {\n        this.eventEmitter.removeAllListeners();\n        return this.getTarget().dispose();\n    }\n}\nexports.TrezorConnectDynamic = TrezorConnectDynamic;\n//# sourceMappingURL=dynamic.js.map"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}