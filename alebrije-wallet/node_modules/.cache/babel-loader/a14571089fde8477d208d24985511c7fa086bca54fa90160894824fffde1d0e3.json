{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.createDeferredManager = void 0;\nconst createDeferred_1 = require(\"./createDeferred\");\nconst createDeferredManager = options => {\n  const {\n    initialId = 0,\n    timeout: defaultTimeout = 0,\n    onTimeout\n  } = options ?? {};\n  const promises = [];\n  let ID = initialId;\n  let timeoutHandle;\n  const length = () => promises.length;\n  const nextId = () => ID;\n  const replanTimeout = () => {\n    const now = Date.now();\n    const nearestDeadline = promises.reduce((prev, _ref) => {\n      let {\n        deadline\n      } = _ref;\n      return (prev && deadline ? Math.min : Math.max)(prev, deadline);\n    }, 0);\n    if (timeoutHandle) clearTimeout(timeoutHandle);\n    timeoutHandle = nearestDeadline ? setTimeout(timeoutCallback, Math.max(nearestDeadline - now, 0)) : undefined;\n  };\n  const timeoutCallback = () => {\n    const now = Date.now();\n    promises.filter(promise => promise.deadline && promise.deadline <= now).forEach(promise => {\n      onTimeout?.(promise.id);\n      promise.deadline = 0;\n    });\n    replanTimeout();\n  };\n  const create = function () {\n    let timeout = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : defaultTimeout;\n    const promiseId = ID++;\n    const deferred = (0, createDeferred_1.createDeferred)(promiseId);\n    const deadline = timeout && Date.now() + timeout;\n    promises.push({\n      ...deferred,\n      deadline\n    });\n    if (timeout) replanTimeout();\n    return {\n      promiseId,\n      promise: deferred.promise\n    };\n  };\n  const extract = promiseId => {\n    const index = promises.findIndex(_ref2 => {\n      let {\n        id\n      } = _ref2;\n      return id === promiseId;\n    });\n    const [promise] = index >= 0 ? promises.splice(index, 1) : [undefined];\n    if (promise?.deadline) replanTimeout();\n    return promise;\n  };\n  const resolve = (promiseId, value) => {\n    const promise = extract(promiseId);\n    promise?.resolve(value);\n    return !!promise;\n  };\n  const reject = (promiseId, error) => {\n    const promise = extract(promiseId);\n    promise?.reject(error);\n    return !!promise;\n  };\n  const rejectAll = error => {\n    promises.forEach(promise => promise.reject(error));\n    const deleted = promises.splice(0, promises.length);\n    if (deleted.length) replanTimeout();\n  };\n  return {\n    length,\n    nextId,\n    create,\n    resolve,\n    reject,\n    rejectAll\n  };\n};\nexports.createDeferredManager = createDeferredManager;","map":{"version":3,"names":["Object","defineProperty","exports","value","createDeferredManager","createDeferred_1","require","options","initialId","timeout","defaultTimeout","onTimeout","promises","ID","timeoutHandle","length","nextId","replanTimeout","now","Date","nearestDeadline","reduce","prev","_ref","deadline","Math","min","max","clearTimeout","setTimeout","timeoutCallback","undefined","filter","promise","forEach","id","create","arguments","promiseId","deferred","createDeferred","push","extract","index","findIndex","_ref2","splice","resolve","reject","error","rejectAll","deleted"],"sources":["/Users/rastavo/alebrije-project/alebrije-wallet/node_modules/@trezor/utils/lib/createDeferredManager.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.createDeferredManager = void 0;\nconst createDeferred_1 = require(\"./createDeferred\");\nconst createDeferredManager = (options) => {\n    const { initialId = 0, timeout: defaultTimeout = 0, onTimeout } = options ?? {};\n    const promises = [];\n    let ID = initialId;\n    let timeoutHandle;\n    const length = () => promises.length;\n    const nextId = () => ID;\n    const replanTimeout = () => {\n        const now = Date.now();\n        const nearestDeadline = promises.reduce((prev, { deadline }) => (prev && deadline ? Math.min : Math.max)(prev, deadline), 0);\n        if (timeoutHandle)\n            clearTimeout(timeoutHandle);\n        timeoutHandle = nearestDeadline\n            ?\n                setTimeout(timeoutCallback, Math.max(nearestDeadline - now, 0))\n            : undefined;\n    };\n    const timeoutCallback = () => {\n        const now = Date.now();\n        promises\n            .filter(promise => promise.deadline && promise.deadline <= now)\n            .forEach(promise => {\n            onTimeout?.(promise.id);\n            promise.deadline = 0;\n        });\n        replanTimeout();\n    };\n    const create = (timeout = defaultTimeout) => {\n        const promiseId = ID++;\n        const deferred = (0, createDeferred_1.createDeferred)(promiseId);\n        const deadline = timeout && Date.now() + timeout;\n        promises.push({ ...deferred, deadline });\n        if (timeout)\n            replanTimeout();\n        return { promiseId, promise: deferred.promise };\n    };\n    const extract = (promiseId) => {\n        const index = promises.findIndex(({ id }) => id === promiseId);\n        const [promise] = index >= 0 ? promises.splice(index, 1) : [undefined];\n        if (promise?.deadline)\n            replanTimeout();\n        return promise;\n    };\n    const resolve = (promiseId, value) => {\n        const promise = extract(promiseId);\n        promise?.resolve(value);\n        return !!promise;\n    };\n    const reject = (promiseId, error) => {\n        const promise = extract(promiseId);\n        promise?.reject(error);\n        return !!promise;\n    };\n    const rejectAll = (error) => {\n        promises.forEach(promise => promise.reject(error));\n        const deleted = promises.splice(0, promises.length);\n        if (deleted.length)\n            replanTimeout();\n    };\n    return { length, nextId, create, resolve, reject, rejectAll };\n};\nexports.createDeferredManager = createDeferredManager;\n//# sourceMappingURL=createDeferredManager.js.map"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}